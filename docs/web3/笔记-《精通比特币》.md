# 《精通比特币》读书笔记





**比特币网络的算力？**

以计算机“每秒能做多少次哈希运算”，来表示其算力。单位是hash/s。

比特币全网算力已进入P算力时代。（1P=1024T，1T=1024G，1G=1024M，1M=1024K）



**比特币的单位？**

1BTC 比特币

100 cBTC 比特分

1000 mBTC 毫比特

1,000,000 uBTC 微比特（100万）

1,000,000,00 SAT 聪 （1亿）



**私钥、地址均由钱包提供的算法生成，无需联网。那么如何保证生成的钱包地址不会重复？**

只要使用密码学安全的随机数源来生成私钥和地址，则该钱包地址就不会重复。

另外，钱包地址中有校验和编码，当你发起交易时输错地址是可以被钱包发现出来的。



**比特币的发行**

成功打包区块，并将区块接入区块链的人，能获得**系统**颁发的比特币奖励，这就是比特币的发行。

而记账成功的人，也能从**交易发起人**处获得手续费。





**如何兑换比特币？**

​	最常见的是在比特币交易所兑换



**比特币如何定价？由谁定价？**

​	有专门的比特币定价服务。

​	定价的方法：根据各个市场上比特币的交易量，加权计算出比特币与法币（美元、人民币等）的平均汇率。



**比特币的矿工费如何算出来？**

交易的手续费，又被称为矿工费，是基于交易的千字节大小来计算的，与交易金额无关。

比特币网络中，节点一般是优先处理手续费更高的交易。手续费越高，交易越快被打包；手续费越低，交易被打包的优先级则越低，甚至不被处理。

现在的钱包、客户端在用户发起交易时，一般会提供多种优先级给用户选择。高优先级意味着高手续费。

Bitcoin Core客户端默认的最低优先级手续费是0.00001BTC/KB，低于该手续费的交易申请会被丢弃。

而实际交易需要多少手续费，可以到相应网站上查询。

实时查询比特币手续费的方法：earnbitcoin网站，显示聪/字节为单位的、不同优先级下的手续费用。

比如有 61聪~70聪/字节的优先级、80聪/字节的优先级。

一笔常规的交易大小约为226字节，因此若使用80聪/字节的优先级，则交易费用约为：

80*226 =18080聪 = 0.00018080 BTC 

按现在1BTC = 22600美元的汇率计算，交易手续费为4.068美元。

交易的大小由输入决定。假设你要支付一笔大额交易，但你的钱包里全都是小额UTXO，那么这笔交易的输入肯定会很大（超过1KB，甚至需要2~3KB），那么手续费肯定就更贵。

> 总结，手续费由两点决定：
>
> 1. 用户是否想这笔交易被更快处理。更快则手续费更贵。
> 2. 用户的交易使用了多少张UTXO（钞票），越多则手续费越贵。
>
> 实时查询比特币手续费的方法：earnbitcoin网站





**比特币交易脚本**

交易原理：

交易前，需要从之前的交易中取出“钱”，即UTXO，才能进行之后的交易。



* 上一笔交易的出参

  * UTXO
  * 锁定脚本（ScriptPubKey，被自己的公钥哈希锁定创建的UTXO）

* 当前交易的入参

  * UTXO
  * 解锁脚本（ScriptSig，使用数字签名解锁需要被消费的UTXO）

* 当前交易的出参
  * UTXO

  * 锁定脚本（ScriptPubKey，使用他人的公钥哈希锁定创建的UTXO）

    

交易会消费掉属于用户的UTXO，并生成新的UTXO。

在比特币网络中，“接受人是你“的交易中，就蕴含了属于你的UTXO。

只要查出有哪些发送给你的交易，就可以计算出你有多少未花费的UTXO。

但在消费这些UTXO之前，你需要成功解锁出参中的锁定脚本，才有权使用某笔交易的UTXO。



这里的锁定脚本、解锁脚本是通过一种称为“P2PKH”的脚本语言编写的。

> P2PKH语言不是一种图灵完备的语言，没有循环或者复杂的流程控制的语法。
>
> 这可保证脚本的执行时间是有限，可预见的，避免该语言创造出无限循环等的“逻辑炸弹”。



此时，我们想从上一笔交易中取出UTXO进行交易，我们便需要解开交易中的锁定脚本。

锁定脚本：<公钥哈希> OP_EQUALVERIFY OP_CHECKSIG



我们通过生成解锁脚本，来解锁上一笔交易中的锁定脚本。

解锁脚本：<数字签名> <公钥> OP_DUP OP_HASH160

> 其中，<>标记的是入参，OP开头是PSPKH脚本语言的语法，是由他们提供的操作码。
>
> 可见用户解锁UTXO需要提供数字签名、还有公钥。

我们组合该两段脚本，输入入参并执行，若返回结果为True，才能成功解锁，获得上一笔交易的UTXO。



当然，”组合脚本并执行“这个操作无需我们负责，我们只需要生成”解锁脚本“，连同”我们需要使用的UTXO“放到交易的入参中即可，比特币网络中的节点自然会帮我们验证我们有没有权利使用这个UTXO。



上面提到的锁定脚本、解锁脚本，并不只有这一对。还有：

* 多重签名脚本（多个数字签名才能解锁UTXO）
* 支付脚本哈希（P2SH）



> 总结：
>
> 比特币交易脚本是交易报文的一部分，是比特币网络验证每一笔交易是否成立的根本。



**高级脚本P2SH**



**比特币网络节点**

比特币网络是一个P2P网络，每个节点既是“客户端”，又是“服务端”。

网络中的节点完全平等。

每个节点均遵从比特币点对点协议，或者其他更高级的协议（称为扩展比特币网络协议）。

节点提供以下一种或多种功能：

* 路由(Network Routing Node)
* 区块链数据库(Full Blockchain)
* 挖矿（Miner）
* 钱包服务（Wallet）

按提供的服务不同，节点又被区分为：

* 全节点：提供所有的功能，维护一份完整的、最新的区块链副本
* 轻量级节点（SPV）：只包含完整区块链副本的一个子集，提供钱包服务、路由功能
* 挖矿节点：挖矿节点之间通过工作量证明算法（POW）互相竞争，创造区块



**扩展比特币网络**

我们一般说的**主网**，是指由几千台运行着Bitcoin Core客户端的节点，以及几百个点对点协议的其他实现例如Bitcoin Classic,Bitcoin Unlimited,BitcoinJ等节点组成。

而其中的一些节点，除了连接到主网，还会遵守其他专用协议，成为其他网络的节点（例如矿池节点、钱包客户端节点）